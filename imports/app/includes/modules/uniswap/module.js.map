{"version":3,"file":"module.js","names":["Module","name","global","isready","isloading","web3providers","console","log","parentscriptloader","callback","self","modulescriptloader","findScriptLoader","getScriptLoader","xtraroot","interfaceroot","moduleroot","push_script","load_scripts","init","_global","_GlobalClass","window","simplestore","Global","getGlobalObject","rootscriptloader","getRootScriptLoader","signalEvent","loadModule","registerHooks","networkid","web3providers_arr","Object","values","i","length","web3provider","scheme","schemeuuid","getSchemeUUID","getEthNodeServerConfig","session","token1","token2","token2amount","uniswap_conf","UniswapAccessClass","getModuleClass","uniswapaccessinstance","getPriceForOutput","token1amountmax","weth","ethamount","ethtx","buyEthOnOutput","buyTokensOnOutput","GlobalClass","registerModuleObject","registerModuleDepency"],"sources":["../../../../../../../../imports/app/includes/modules/uniswap/module.js"],"sourcesContent":["'use strict';\n\nvar Module = class {\n\t\n\tconstructor() {\n\t\tthis.name = 'uniswap';\n\t\t\n\t\tthis.global = null; // put by global on registration\n\t\tthis.isready = false;\n\t\tthis.isloading = false;\n\t\t\n\t\tthis.web3providers = [];\n\t}\n\t\n\tinit() {\n\t\tconsole.log('module init called for ' + this.name);\n\t\t\n\t\tvar global = this.global;\n\t\t\n\t\tthis.isready = true;\n\t}\n\t\n\tloadModule(parentscriptloader, callback) {\n\t\tconsole.log('loadModule called for module ' + this.name);\n\n\t\tif (this.isloading)\n\t\t\treturn;\n\t\t\t\n\t\tthis.isloading = true;\n\n\t\tvar self = this;\n\t\tvar global = this.global;\n\n\t\t// wallet module script loader\n\t\tvar modulescriptloader;\n\t\t\n\t\t// look if uniswaploader already created (e.g. for loading in node.js)\n\t\tmodulescriptloader = global.findScriptLoader('uniswaploader');\n\n\t\t// if not, create on as child as parent script loader passed in argument\n\t\tif (!modulescriptloader)\n\t\tmodulescriptloader = global.getScriptLoader('uniswaploader', parentscriptloader);\n\t\t\n\t\t\n\t\tvar xtraroot = './includes';\n\t\t\n\t\tvar interfaceroot = xtraroot + '/interface';\n\n\t\t//modulescriptloader.push_script( interfaceroot + '/wallet-server-access.js');\n\t\t\n\t\tvar moduleroot = xtraroot + '/modules/uniswap';\n\n\t\tmodulescriptloader.push_script( moduleroot + '/model/uniswap-access.js');\n\n\t\tmodulescriptloader.push_script( moduleroot + '/model/interface/v2/factory-contract-interface.js');\n\t\tmodulescriptloader.push_script( moduleroot + '/model/interface/v2/pair-contract-interface.js');\n\t\tmodulescriptloader.push_script( moduleroot + '/model/interface/v2/router02-contract-interface.js');\n\t\t\n\t\tmodulescriptloader.load_scripts(function() { self.init(); if (callback) callback(null, self); });\n\t\t\n\t\treturn modulescriptloader;\n\t}\n\t\n\t_getGlobalObject() {\n\t\tvar _global = (this.global ? this.global : null);\n\t\t\n\t\tif (!_global) {\n\t\t\tlet _GlobalClass;\n\n\t\t\tif (typeof window !== 'undefined') {\n\t\t\t\t_GlobalClass = ( window && window.simplestore && window.simplestore.Global ? window.simplestore.Global : null);\n\t\t\t}\n\t\t\telse if (typeof global !== 'undefined') {\n\t\t\t\t// we are in node js\n\t\t\t\t_GlobalClass = ( global && global.simplestore && global.simplestore.Global ? global.simplestore.Global : null);\n\t\t\t}\n\t\t\t\n\t\t\t_global = _GlobalClass.getGlobalObject();\n\t\t}\n\t\t\t\n\t\treturn _global;\n\t}\n\t\n\n\tisReady() {\n\t\treturn this.isready;\n\t}\n\n\thasLoadStarted() {\n\t\treturn this.isloading;\n\t}\n\t\n\t// optional  module functions\n\tregisterHooks() {\n\t\tconsole.log('module registerHooks called for ' + this.name);\n\t\t\n\t\tvar global = this.global;\n\t\t\n\t\t// signal module is ready\n\t\tvar rootscriptloader = global.getRootScriptLoader();\n\t\trootscriptloader.signalEvent('on_uniswap_module_ready');\n\t}\n\t\n\tpostRegisterModule() {\n\t\tconsole.log('postRegisterModule called for ' + this.name);\n\t\tif (!this.isloading) {\n\t\t\tvar global = this.global;\n\t\t\tvar self = this;\n\t\t\tvar rootscriptloader = global.getRootScriptLoader();\n\t\t\t\n\t\t\tthis.loadModule(rootscriptloader, function() {\n\t\t\t\tif (self.registerHooks)\n\t\t\t\tself.registerHooks();\n\t\t\t});\n\t\t}\n\t}\n\t\n\t\n\t//\n\t// hooks\n\t//\n\n\t\n\t// functions\n\tfindWeb3Provider(networkid) {\n\t\tvar web3providers_arr = Object.values(this.web3providers);\n\n\t\tfor (var i = 0; i < web3providers_arr.length; i++) {\n\t\t\tvar web3provider = web3providers_arr[i];\n\n\t\t\tif (web3provider.networkid == networkid)\n\t\t\t\treturn web3provider;\n\t\t}\n\t}\n\t\n\n\taddWeb3Provider(scheme) {\n\t\tvar schemeuuid = scheme.getSchemeUUID();\n\t\t\n\t\tthis.web3providers[schemeuuid] = scheme.getEthNodeServerConfig();\n\t}\n\n\n\tasync getPriceForOutput(session, scheme, token1, token2, token2amount, uniswap_conf) {\n\t\tvar global = this.global;\n\n\t\tvar UniswapAccessClass = global.getModuleClass('uniswap', 'UniswapAccess');\n\t\tvar uniswapaccessinstance = new UniswapAccessClass(session, this);\n\n\t\treturn uniswapaccessinstance.getPriceForOutput(scheme, token1, token2, token2amount, uniswap_conf);\n\t}\n\n\tasync buyEthOnOutput(session, scheme, token1, token1amountmax, weth, ethamount, uniswap_conf, ethtx) {\n\t\tvar global = this.global;\n\n\t\tvar UniswapAccessClass = global.getModuleClass('uniswap', 'UniswapAccess');\n\t\tvar uniswapaccessinstance = new UniswapAccessClass(session, this);\n\n\t\treturn uniswapaccessinstance.buyEthOnOutput(scheme, token1, token1amountmax, weth, ethamount, uniswap_conf, ethtx);\n\t}\n\n\tasync buyTokensOnOutput(session, scheme, token1, token1amountmax, token2, token2amount, uniswap_conf, ethtx) {\n\t\tvar global = this.global;\n\n\t\tvar UniswapAccessClass = global.getModuleClass('uniswap', 'UniswapAccess');\n\t\tvar uniswapaccessinstance = new UniswapAccessClass(session, this);\n\n\t\treturn uniswapaccessinstance.buyTokensOnOutput(scheme, token1, token1amountmax, token2, token2amount, uniswap_conf, ethtx);\n\t}\n\n}\n\n\nif ( typeof window !== 'undefined' && typeof window.GlobalClass !== 'undefined' && window.GlobalClass ) {\n\tvar _GlobalClass = window.GlobalClass;\n}\nelse if (typeof window !== 'undefined') {\n\tvar _GlobalClass = ( window && window.simplestore && window.simplestore.Global ? window.simplestore.Global : null);\n}\nelse if (typeof global !== 'undefined') {\n\t// we are in node js\n\tvar _GlobalClass = ( global && global.simplestore && global.simplestore.Global ? global.simplestore.Global : null);\n}\n\n_GlobalClass.getGlobalObject().registerModuleObject(new Module());\n\n// dependencies\n_GlobalClass.getGlobalObject().registerModuleDepency('uniswap', 'common');\t\t\n\n"],"mappings":"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"}