{"version":3,"file":"module.js","names":["Module","name","global","app","controllers","isready","isloading","console","log","parentscriptloader","callback","self","Ethereum_ERC721","require","ethereum_erc721","getObject","init","modulescriptloader","getChildLoader","load_scripts","registerHook","creatingSession_hook","rootscriptloader","getRootScriptLoader","loadModule","registerHooks","result","params","session","ethnodemodule","getModuleObject","contracts","getContractsObject","registerContractClass","Minter","push","module","handled","currency","data","deeds_v1","Promise","reject","basetokenuri","getGlobalObject","address","symbol","description","contract","createBlankContractObject","setAddress","setLocalName","setLocalSymbol","setLocalBaseTokenURI","setLocalDescription","locker","LockerClass","getModuleClass","contractaddress","currenciesmodule","getCurrencyWeb3ProviderUrl","web3providerurl","retrieve","value","contentstring","ethtx","store","txhash","window","GlobalClass","_GlobalClass","simplestore","Global","registerModuleObject","registerModuleDepency"],"sources":["../../../../../../../../../../../../imports/app/react-js-ui/js/src/model/myquote/includes/erc721/module.js"],"sourcesContent":["'use strict';\n\n\nvar Module = class {\n\t\n\tconstructor() {\n\t\tthis.name = 'mvc-erc721';\n\t\t\n\t\tthis.global = null; // put by global on registration\n\t\tthis.app = null;\n\t\t\n\t\tthis.controllers = null;\n\n\t\tthis.isready = false;\n\t\tthis.isloading = false;\n\t\t\n\t}\n\t\n\tinit() {\n\t\tconsole.log('module init called for ' + this.name);\n\n\t\tvar global = this.global;\n\t\t\n\t\tthis.isready = true;\n\t}\n\t\n\t// compulsory  module functions\n\tloadModule(parentscriptloader, callback) {\n\t\tconsole.log('loadModule called for module ' + this.name);\n\t\t\n\t\tif (this.isloading)\n\t\t\treturn;\n\t\t\t\n\t\tthis.isloading = true;\n\n\t\tvar self = this;\n\n\t\t// load @p2pmoney-org/ethereum_erc721\n\t\tvar Ethereum_ERC721 = require('@p2pmoney-org/ethereum_erc721');\n\t\t//var Ethereum_ERC721 = require('../../../../../../../nodemodules/@p2pmoney-org/ethereum_erc721');\n\t\tvar ethereum_erc721 = Ethereum_ERC721.getObject();\n\t\tethereum_erc721.init();\n\n\t\t// load module's files\n\t\tvar modulescriptloader = parentscriptloader.getChildLoader('mvcerc721loader');\n\n\t\tmodulescriptloader.load_scripts(function() { self.init(); if (callback) callback(null, self); });\n\n\t\treturn modulescriptloader;\t\n\t}\n\t\n\tisReady() {\n\t\treturn this.isready;\n\t}\n\n\thasLoadStarted() {\n\t\treturn this.isloading;\n\t}\n\n\t// optional module functions\n\tregisterHooks() {\n\t\tconsole.log('module registerHooks called for ' + this.name);\n\t\t\n\t\tvar global = this.global;\n\n\t\tglobal.registerHook('creatingSession_hook', this.name, this.creatingSession_hook);\n\t}\n\t\n\tpostRegisterModule() {\n\t\tconsole.log('postRegisterModule called for ' + this.name);\n\t\tif (!this.isloading) {\n\t\t\tvar global = this.global;\n\t\t\tvar self = this;\n\t\t\tvar rootscriptloader = global.getRootScriptLoader();\n\t\t\t\n\t\t\tthis.loadModule(rootscriptloader, function() {\n\t\t\t\tif (self.registerHooks)\n\t\t\t\tself.registerHooks();\n\t\t\t});\n\t\t}\n\t}\n\n\t//\n\t// hooks\n\t//\n\tcreatingSession_hook(result, params) {\n\t\tconsole.log('creatingSession_hook called for ' + this.name);\n\t\t\n\t\tvar global = this.global;\n\t\tvar session = params[0];\n\t\t\n\t\tvar ethnodemodule = global.getModuleObject('ethnode');\n\t\t\n\t\tvar contracts = ethnodemodule.getContractsObject(session);\n\t\t\n\t\t// register Minter in the contracts global object\n\t\t// (could be transfered to preFinalizeGlobalScopeInit_hook if necessary)\n\t\tcontracts.registerContractClass('Minter', this.Minter);\n\t\t\n\t\t// force refresh of list\n\t\tethnodemodule.getContractsObject(session, true);\n\t\tresult.push({module: this.name, handled: true});\n\t\t\n\t\treturn true;\n\t}\n\n\t\n\t// API\n\tasync createERC721TokenObject(session, currency, data) {\n\t\tif (!currency || !currency.deeds_v1)\n\t\t\treturn Promise.reject('currency does not support erc721');\n\n\t\tif (!data['basetokenuri']) {\n\t\t\tif (!currency.deeds_v1.basetokenuri)\n\t\t\treturn Promise.reject('currency does not provide a base token uri');\n\n\t\t\t// fill basetokenuri\n\t\t\tdata['basetokenuri'] = currency.deeds_v1.basetokenuri;\n\t\t}\n\t\n\t\tvar global = this.global;\n\t\t\n\t\t// create contract using Minter class\n\t\tvar global = session.getGlobalObject();\n\n\t\tvar address = (data && data['address'] ? data['address'] : null);\n\n\t\tvar name = (data && data['name'] ? data['name'] : null);\n\t\tvar symbol = (data && data['symbol'] ? data['symbol'] : null);\n\t\tvar basetokenuri = (data && data['basetokenuri'] ? data['basetokenuri'] : null);\n\t\t\n\t\tvar description = (data && data['description'] ? data['description'] : null);\n\n\n\t\tvar ethnodemodule = global.getModuleObject('ethnode');\n\t\t\n\t\tvar contracts = ethnodemodule.getContractsObject(session);\n\t\t\n\t\t\n\t\tvar contract = contracts.createBlankContractObject('Minter');\n\t\t\n\t\tcontract.setAddress(address);\n\n\t\tcontract.setLocalName(name);\n\t\tcontract.setLocalSymbol(symbol);\n\t\tcontract.setLocalBaseTokenURI(basetokenuri);\n\n\t\tcontract.setLocalDescription(description);\n\t\t\n\t\treturn contract;\t\n\t}\n\n\t// locker functions\n\tasync getLockerContent(session, currency, address) {\n\t\tif (!currency || !currency.deeds_v1 || !currency.deeds_v1.locker)\n\t\t\treturn Promise.reject('currency does not support erc721');\n\n\t\tvar global = this.global;\n\n\t\tvar LockerClass = global.getModuleClass('mvc-erc721', 'Locker');\n\n\t\tvar contractaddress = currency.deeds_v1.locker;\n\n\t\tvar currenciesmodule = global.getModuleObject('currencies');\n\n\t\tvar web3providerurl = await currenciesmodule.getCurrencyWeb3ProviderUrl(session, currency)\n\n\t\tvar locker = new LockerClass(session, contractaddress, web3providerurl);\n\n\t\tvar value = await locker.retrieve(address);\n\n\t\treturn value;\n\t}\n\t\n\tasync putLockerContent(session, currency, contentstring, ethtx) {\n\t\tif (!currency || !currency.deeds_v1 || !currency.deeds_v1.locker)\n\t\t\treturn Promise.reject('currency does not support erc721');\n\n\t\tvar global = this.global;\n\n\t\tvar LockerClass = global.getModuleClass('mvc-erc721', 'Locker');\n\n\t\tvar contractaddress = currency.deeds_v1.locker;\n\n\t\tvar currenciesmodule = global.getModuleObject('currencies');\n\n\t\tvar web3providerurl = await currenciesmodule.getCurrencyWeb3ProviderUrl(session, currency)\n\n\t\tvar locker = new LockerClass(session, contractaddress, web3providerurl);\n\n\t\tvar txhash = await locker.store(contentstring, ethtx);\n\n\t\treturn txhash;\n\t}\n\t\n}\n\n\nif ( typeof window !== 'undefined' && typeof window.GlobalClass !== 'undefined' && window.GlobalClass ) {\n\tvar _GlobalClass = window.GlobalClass;\n}\nelse if (typeof window !== 'undefined') {\n\tvar _GlobalClass = ( window && window.simplestore && window.simplestore.Global ? window.simplestore.Global : null);\n}\nelse if (typeof global !== 'undefined') {\n\t// we are in node js\n\tvar _GlobalClass = ( global && global.simplestore && global.simplestore.Global ? global.simplestore.Global : null);\n}\n\n_GlobalClass.getGlobalObject().registerModuleObject(new Module());\n\n// dependencies\n_GlobalClass.getGlobalObject().registerModuleDepency('mvc-erc721', 'common');\n"],"mappings":"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"}